- name: Copy MySQL Repo
  copy:
    src: mysql.repo
    dest: /etc/yum.repos.d/mysql.repo


- name: INstall MySQL and Dependencies
  yum:
    name: ["mysql-community-server", "python2-PyMySQL"]
    state: latest

- name: Start MySQL
  systemd:
    name: mysqld
    state: started

- name: Wait until service starts
  wait_for:
    port: 3306

- name: Grab default password
  shell: grep 'temporary password' /var/log/mysqld.log | awk '{print $NF}'
  register: MYSQL_DEFAULT_PASSWORD

- name: COpy rest password scrip
  template:
    src: mysql-root-password-reset.sql
    dest: /tmp/mysql-root-password-reset.sql

- name: Set root user password
  shell: mysql --connect-expired-password -uroot -p"{{MYSQL_DEFAULT_PASSWORD.stdout}}" </tmp/mysql-root-password-reset.sql


















